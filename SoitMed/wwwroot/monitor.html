<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<title>SoitMed Backend Monitor</title>
		<style>
			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana,
					sans-serif;
				margin: 0;
				padding: 20px;
				background: linear-gradient(
					135deg,
					#667eea 0%,
					#764ba2 100%
				);
				color: white;
				min-height: 100vh;
			}
			.container {
				max-width: 1200px;
				margin: 0 auto;
			}
			.header {
				text-align: center;
				margin-bottom: 30px;
			}
			.status-card {
				background: rgba(255, 255, 255, 0.1);
				border-radius: 10px;
				padding: 20px;
				margin: 10px;
				backdrop-filter: blur(10px);
				border: 1px solid rgba(255, 255, 255, 0.2);
			}
			.status-grid {
				display: grid;
				grid-template-columns: repeat(
					auto-fit,
					minmax(300px, 1fr)
				);
				gap: 20px;
				margin-bottom: 30px;
			}
			.status-indicator {
				display: inline-block;
				width: 12px;
				height: 12px;
				border-radius: 50%;
				margin-right: 8px;
			}
			.status-ok {
				background-color: #4caf50;
			}
			.status-error {
				background-color: #f44336;
			}
			.status-warning {
				background-color: #ff9800;
			}
			.status-unknown {
				background-color: #9e9e9e;
			}
			.refresh-btn {
				background: #4caf50;
				color: white;
				border: none;
				padding: 10px 20px;
				border-radius: 5px;
				cursor: pointer;
				font-size: 16px;
				margin: 10px;
			}
			.refresh-btn:hover {
				background: #45a049;
			}
			.log-container {
				background: rgba(0, 0, 0, 0.3);
				border-radius: 10px;
				padding: 20px;
				margin-top: 20px;
				max-height: 400px;
				overflow-y: auto;
			}
			.log-entry {
				margin: 5px 0;
				padding: 5px;
				border-radius: 3px;
				font-family: 'Courier New', monospace;
				font-size: 12px;
			}
			.log-info {
				background: rgba(33, 150, 243, 0.2);
			}
			.log-error {
				background: rgba(244, 67, 54, 0.2);
			}
			.log-warning {
				background: rgba(255, 152, 0, 0.2);
			}
			.timestamp {
				color: #bbb;
				font-size: 10px;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h1>üè• SoitMed Backend Monitor</h1>
				<p>Real-time application health monitoring</p>
				<button
					class="refresh-btn"
					onclick="refreshStatus()"
				>
					üîÑ Refresh Status
				</button>
				<button
					class="refresh-btn"
					onclick="toggleAutoRefresh()"
				>
					‚è∞ Auto Refresh:
					<span id="autoRefreshStatus">OFF</span>
				</button>
			</div>

			<div class="status-grid">
				<div class="status-card">
					<h3>üåê Application Status</h3>
					<p>
						<span
							id="appStatus"
							class="status-indicator status-unknown"
						></span
						><span id="appStatusText"
							>Checking...</span
						>
					</p>
					<p>
						<strong>URL:</strong>
						<a
							href="http://localhost:5117"
							target="_blank"
							style="color: #4caf50"
							>http://localhost:5117</a
						>
					</p>
					<p>
						<strong>Swagger UI:</strong>
						<a
							href="http://localhost:5117/swagger"
							target="_blank"
							style="color: #4caf50"
							>http://localhost:5117/swagger</a
						>
					</p>
				</div>

				<div class="status-card">
					<h3>üíæ Database Status</h3>
					<p>
						<span
							id="dbStatus"
							class="status-indicator status-unknown"
						></span
						><span id="dbStatusText"
							>Checking...</span
						>
					</p>
					<p>
						<strong>Connection:</strong>
						<span id="dbConnection"
							>Unknown</span
						>
					</p>
				</div>

				<div class="status-card">
					<h3>üîß Health Checks</h3>
					<p>
						<span
							id="healthStatus"
							class="status-indicator status-unknown"
						></span
						><span id="healthStatusText"
							>Checking...</span
						>
					</p>
					<p>
						<strong>Ready:</strong>
						<span id="readyStatus"
							>Unknown</span
						>
					</p>
					<p>
						<strong>Live:</strong>
						<span id="liveStatus"
							>Unknown</span
						>
					</p>
				</div>

				<div class="status-card">
					<h3>üìä System Info</h3>
					<p>
						<strong>Uptime:</strong>
						<span id="uptime">Unknown</span>
					</p>
					<p>
						<strong>Last Check:</strong>
						<span id="lastCheck"
							>Never</span
						>
					</p>
					<p>
						<strong>Response Time:</strong>
						<span id="responseTime"
							>Unknown</span
						>
					</p>
				</div>
			</div>

			<div class="log-container">
				<h3>Activity Log</h3>
				<div id="logEntries"></div>
			</div>
		</div>

		<script>
			let autoRefreshInterval = null;
			let isAutoRefresh = false;

			function log(message, type = 'info') {
				const logContainer =
					document.getElementById('logEntries');
				const timestamp =
					new Date().toLocaleTimeString();
				const logEntry = document.createElement('div');
				logEntry.className = `log-entry log-${type}`;
				logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
				logContainer.insertBefore(
					logEntry,
					logContainer.firstChild
				);

				// Keep only last 50 entries
				while (logContainer.children.length > 50) {
					logContainer.removeChild(
						logContainer.lastChild
					);
				}
			}

			function updateStatus(elementId, status, text) {
				const element =
					document.getElementById(elementId);
				element.className = `status-indicator status-${status}`;
				document.getElementById(
					elementId + 'Text'
				).textContent = text;
			}

			async function checkHealth() {
				const startTime = Date.now();
				try {
					const response = await fetch(
						'http://localhost:5117/health'
					);
					const data = await response.json();
					const responseTime =
						Date.now() - startTime;

					updateStatus(
						'appStatus',
						'ok',
						'Running'
					);
					updateStatus(
						'healthStatus',
						'ok',
						'Healthy'
					);
					document.getElementById(
						'responseTime'
					).textContent = `${responseTime}ms`;
					document.getElementById(
						'lastCheck'
					).textContent =
						new Date().toLocaleString();

					log(
						`Health check successful - Response time: ${responseTime}ms`,
						'info'
					);

					// Check database status
					try {
						const dbResponse = await fetch(
							'http://localhost:5117/health/ready'
						);
						if (dbResponse.ok) {
							updateStatus(
								'dbStatus',
								'ok',
								'Connected'
							);
							document.getElementById(
								'dbConnection'
							).textContent =
								'Active';
						} else {
							updateStatus(
								'dbStatus',
								'error',
								'Disconnected'
							);
							document.getElementById(
								'dbConnection'
							).textContent =
								'Failed';
							log(
								'Database health check failed',
								'error'
							);
						}
					} catch (dbError) {
						updateStatus(
							'dbStatus',
							'error',
							'Error'
						);
						document.getElementById(
							'dbConnection'
						).textContent = 'Error';
						log(
							`Database check error: ${dbError.message}`,
							'error'
						);
					}
				} catch (error) {
					updateStatus(
						'appStatus',
						'error',
						'Offline'
					);
					updateStatus(
						'healthStatus',
						'error',
						'Unhealthy'
					);
					updateStatus(
						'dbStatus',
						'error',
						'Unknown'
					);
					document.getElementById(
						'responseTime'
					).textContent = 'N/A';
					document.getElementById(
						'lastCheck'
					).textContent =
						new Date().toLocaleString();
					log(
						`Application check failed: ${error.message}`,
						'error'
					);
				}
			}

			function refreshStatus() {
				log('Manual refresh triggered', 'info');
				checkHealth();
			}

			function toggleAutoRefresh() {
				if (isAutoRefresh) {
					clearInterval(autoRefreshInterval);
					isAutoRefresh = false;
					document.getElementById(
						'autoRefreshStatus'
					).textContent = 'OFF';
					log('Auto refresh disabled', 'info');
				} else {
					autoRefreshInterval = setInterval(
						checkHealth,
						5000
					); // Check every 5 seconds
					isAutoRefresh = true;
					document.getElementById(
						'autoRefreshStatus'
					).textContent = 'ON';
					log(
						'Auto refresh enabled (5s interval)',
						'info'
					);
				}
			}

			// Initial load
			log('Monitor started', 'info');
			checkHealth();
		</script>
	</body>
</html>
